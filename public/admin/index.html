<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=2.0" />
    <title>WarehouseHub CMS - Mobile Optimized</title>
    
    <!-- Enhanced mobile optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WarehouseHub CMS">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.svg">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- Custom mobile-optimized styles -->
    <style>
      /* Mobile-first CMS optimization */
      :root {
        --primary-color: #2563eb;
        --secondary-color: #1e40af;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --text-color: #1f2937;
        --bg-color: #f9fafb;
        --card-bg: #ffffff;
        --border-color: #e5e7eb;
        --radius: 12px;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      /* Global mobile optimizations */
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: var(--bg-color);
        margin: 0;
        padding: 0;
        touch-action: manipulation;
      }

      /* Enhanced CMS container for mobile */
      .cms-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow-x: hidden;
      }

      /* Mobile loading state */
      .cms-loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--bg-color);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 9999;
      }

      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 4px solid var(--border-color);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .loading-text {
        color: var(--text-color);
        font-size: 18px;
        font-weight: 600;
        text-align: center;
        max-width: 280px;
        line-height: 1.5;
      }

      /* Mobile-optimized welcome screen */
      .welcome-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        z-index: 9998;
      }

      .welcome-card {
        background: white;
        padding: 40px 30px;
        border-radius: 20px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        text-align: center;
        max-width: 400px;
        width: 100%;
        margin: 20px;
      }

      .welcome-logo {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 20px;
        margin: 0 auto 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: bold;
      }

      .welcome-title {
        font-size: 28px;
        font-weight: 800;
        color: var(--text-color);
        margin-bottom: 12px;
        line-height: 1.2;
      }

      .welcome-subtitle {
        font-size: 16px;
        color: #6b7280;
        margin-bottom: 32px;
        line-height: 1.5;
      }

      .login-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s ease;
        touch-action: manipulation;
        min-height: 52px;
      }

      .login-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 25px -5px rgba(37, 99, 235, 0.4);
      }

      .login-btn:active {
        transform: translateY(0);
      }

      /* Mobile status indicators */
      .status-indicator {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 8px 16px;
        background: var(--success-color);
        color: white;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: var(--shadow);
        transform: translateY(-100px);
        transition: transform 0.3s ease;
      }

      .status-indicator.show {
        transform: translateY(0);
      }

      .status-indicator.error {
        background: var(--danger-color);
      }

      .status-indicator.warning {
        background: var(--warning-color);
      }

      /* Mobile touch improvements */
      @media (max-width: 768px) {
        .welcome-card {
          margin: 10px;
          padding: 32px 24px;
        }

        .welcome-title {
          font-size: 24px;
        }

        .welcome-subtitle {
          font-size: 15px;
        }

        .login-btn {
          font-size: 15px;
          padding: 14px 28px;
        }
      }

      /* Hide CMS initially */
      .nc-app-container {
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .nc-app-container.loaded {
        opacity: 1;
      }

      /* Custom CMS overrides for mobile */
      .nc-sidebar-container {
        width: 100% !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        height: 100% !important;
        z-index: 1000 !important;
        transform: translateX(-100%) !important;
        transition: transform 0.3s ease !important;
      }

      .nc-sidebar-container.open {
        transform: translateX(0) !important;
      }

      /* Enhanced mobile collection list */
      .nc-collectionPage-sidebarButton {
        position: fixed !important;
        top: 20px !important;
        left: 20px !important;
        z-index: 1001 !important;
        background: var(--primary-color) !important;
        color: white !important;
        border: none !important;
        border-radius: 12px !important;
        padding: 12px !important;
        box-shadow: var(--shadow) !important;
        width: 48px !important;
        height: 48px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }

      /* Mobile editor improvements */
      .nc-entryEditor-container {
        padding: 20px !important;
        max-width: 100% !important;
      }

      .nc-fieldLabel-container {
        margin-bottom: 8px !important;
      }

      .nc-fieldLabel-text {
        font-size: 15px !important;
        font-weight: 600 !important;
        color: var(--text-color) !important;
      }

      .nc-textControl-input,
      .nc-textControl-textarea {
        font-size: 16px !important; /* Prevents zoom on iOS */
        border-radius: var(--radius) !important;
        border: 2px solid var(--border-color) !important;
        padding: 12px 16px !important;
        transition: border-color 0.3s ease !important;
      }

      .nc-textControl-input:focus,
      .nc-textControl-textarea:focus {
        border-color: var(--primary-color) !important;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1) !important;
        outline: none !important;
      }

      /* Mobile image upload improvements */
      .nc-fileControl-container {
        border-radius: var(--radius) !important;
        border: 2px dashed var(--border-color) !important;
        background: var(--bg-color) !important;
        padding: 32px 20px !important;
        text-align: center !important;
        transition: all 0.3s ease !important;
      }

      .nc-fileControl-container:hover {
        border-color: var(--primary-color) !important;
        background: rgba(37, 99, 235, 0.05) !important;
      }

      /* Mobile save buttons */
      .nc-entryEditor-controlPane {
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        background: white !important;
        border-top: 1px solid var(--border-color) !important;
        padding: 16px 20px !important;
        box-shadow: 0 -5px 15px -3px rgba(0, 0, 0, 0.1) !important;
        z-index: 1000 !important;
      }

      .nc-entryEditor-controlPane button {
        font-size: 16px !important;
        padding: 14px 28px !important;
        border-radius: var(--radius) !important;
        font-weight: 600 !important;
        min-height: 48px !important;
        touch-action: manipulation !important;
      }

      /* Mobile collection cards */
      .nc-collectionCard-container {
        border-radius: var(--radius) !important;
        border: 1px solid var(--border-color) !important;
        background: var(--card-bg) !important;
        margin-bottom: 16px !important;
        padding: 20px !important;
        box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1) !important;
        transition: all 0.3s ease !important;
      }

      .nc-collectionCard-container:hover {
        box-shadow: var(--shadow) !important;
        transform: translateY(-2px) !important;
      }

      /* Mobile list improvements */
      .nc-listCard-container {
        padding: 16px 20px !important;
        border-bottom: 1px solid var(--border-color) !important;
        background: var(--card-bg) !important;
      }

      .nc-listCard-container:last-child {
        border-bottom: none !important;
      }

      /* Mobile workflow status */
      .nc-workflowStatus-container {
        border-radius: 20px !important;
        padding: 6px 12px !important;
        font-size: 12px !important;
        font-weight: 600 !important;
        text-transform: uppercase !important;
        letter-spacing: 0.5px !important;
      }

      /* Mobile responsive table */
      @media (max-width: 768px) {
        .nc-listCardGrid-container {
          display: block !important;
        }

        .nc-listCardGrid-card {
          display: block !important;
          width: 100% !important;
          margin-bottom: 16px !important;
          padding: 16px !important;
          border: 1px solid var(--border-color) !important;
          border-radius: var(--radius) !important;
          background: var(--card-bg) !important;
          box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1) !important;
        }
      }

      /* Enhanced mobile navigation */
      .nc-navbar-container {
        background: var(--card-bg) !important;
        border-bottom: 1px solid var(--border-color) !important;
        box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1) !important;
        padding: 12px 20px !important;
      }

      /* Mobile-specific help text */
      .mobile-help {
        position: fixed;
        bottom: 100px;
        right: 20px;
        background: var(--text-color);
        color: white;
        padding: 12px 16px;
        border-radius: 20px;
        font-size: 14px;
        max-width: 280px;
        box-shadow: var(--shadow);
        z-index: 10000;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
      }

      .mobile-help.show {
        opacity: 1;
        transform: translateY(0);
      }

      /* Touch-friendly spacing */
      .nc-fieldWrapper-container {
        margin-bottom: 24px !important;
      }

      /* Better mobile modals */
      .nc-modal-container {
        padding: 20px !important;
      }

      .nc-modal-content {
        border-radius: var(--radius) !important;
        max-height: 90vh !important;
        overflow-y: auto !important;
      }
    </style>
  </head>
  <body>
    <div class="cms-container">
      <!-- Enhanced loading screen -->
      <div class="cms-loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading WarehouseHub CMS...</div>
      </div>

      <!-- Mobile-optimized welcome screen -->
      <div class="welcome-screen" id="welcome" style="display: none;">
        <div class="welcome-card">
          <div class="welcome-logo">WH</div>
          <h1 class="welcome-title">WarehouseHub CMS</h1>
          <p class="welcome-subtitle">Manage your warehouse properties and leads with our mobile-optimized content management system</p>
          <button class="login-btn" onclick="netlifyIdentity.open()">
            Login to Continue
          </button>
        </div>
      </div>

      <!-- Status indicator for mobile feedback -->
      <div class="status-indicator" id="status"></div>

      <!-- Mobile help tooltip -->
      <div class="mobile-help" id="mobileHelp">
        💡 Tap the menu button in the top-left to navigate between sections
      </div>
    </div>

    <!-- Include the script that builds the page and powers Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    
    <script>
      // Enhanced mobile CMS initialization
      document.addEventListener('DOMContentLoaded', function() {
        const loading = document.getElementById('loading');
        const welcome = document.getElementById('welcome');
        const status = document.getElementById('status');
        const mobileHelp = document.getElementById('mobileHelp');

        // Check if user is already logged in
        if (window.netlifyIdentity) {
          window.netlifyIdentity.on('init', user => {
            if (!user) {
              // Not logged in, show welcome screen
              loading.style.display = 'none';
              welcome.style.display = 'flex';
            } else {
              // Logged in, initialize CMS
              initializeCMS();
            }
          });

          // Handle login
          window.netlifyIdentity.on('login', () => {
            welcome.style.display = 'none';
            initializeCMS();
          });

          // Handle logout
          window.netlifyIdentity.on('logout', () => {
            location.reload();
          });
        }

        function initializeCMS() {
          loading.style.display = 'flex';
          
          // Show mobile help after a delay
          setTimeout(() => {
            if (window.innerWidth <= 768) {
              mobileHelp.classList.add('show');
              setTimeout(() => {
                mobileHelp.classList.remove('show');
              }, 5000);
            }
          }, 3000);

          // Initialize CMS with mobile optimizations
          setTimeout(() => {
            loading.style.display = 'none';
            const cmsContainer = document.querySelector('.nc-app-container');
            if (cmsContainer) {
              cmsContainer.classList.add('loaded');
            }
            showStatus('CMS Ready!', 'success');
          }, 2000);
        }

        function showStatus(message, type = 'success') {
          status.textContent = message;
          status.className = `status-indicator ${type}`;
          status.classList.add('show');
          
          setTimeout(() => {
            status.classList.remove('show');
          }, 3000);
        }

        // Mobile-specific enhancements
        if (window.innerWidth <= 768) {
          // Add touch-friendly improvements
          document.body.style.touchAction = 'manipulation';
          
          // Prevent zoom on input focus (iOS)
          const inputs = document.querySelectorAll('input, textarea, select');
          inputs.forEach(input => {
            input.style.fontSize = '16px';
          });

          // Add swipe gestures for navigation
          let startX = 0;
          let startY = 0;
          
          document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
          });
          
          document.addEventListener('touchend', (e) => {
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;
            
            // Check if it's a horizontal swipe
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
              if (diffX > 0) {
                // Swipe left - close sidebar
                const sidebar = document.querySelector('.nc-sidebar-container');
                if (sidebar) {
                  sidebar.classList.remove('open');
                }
              } else {
                // Swipe right - open sidebar
                const sidebar = document.querySelector('.nc-sidebar-container');
                if (sidebar) {
                  sidebar.classList.add('open');
                }
              }
            }
          });
        }

        // Add viewport height adjustment for mobile browsers
        function setViewportHeight() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        setViewportHeight();
        window.addEventListener('resize', setViewportHeight);
        window.addEventListener('orientationchange', setViewportHeight);

        // Add haptic feedback for touch interactions (if supported)
        if ('vibrate' in navigator) {
          document.addEventListener('click', (e) => {
            if (e.target.matches('button, .nc-listCard-container, .nc-collectionCard-container')) {
              navigator.vibrate(10); // Short vibration
            }
          });
        }

        // Auto-save improvements for mobile
        let autoSaveTimeout;
        document.addEventListener('input', (e) => {
          if (e.target.matches('.nc-textControl-input, .nc-textControl-textarea')) {
            clearTimeout(autoSaveTimeout);
            showStatus('Auto-saving...', 'warning');
            
            autoSaveTimeout = setTimeout(() => {
              showStatus('Saved!', 'success');
            }, 2000);
          }
        });

        // Mobile connection status
        function updateConnectionStatus() {
          if (!navigator.onLine) {
            showStatus('Offline Mode', 'error');
          } else {
            showStatus('Online', 'success');
          }
        }
        
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
      });

      // Custom CMS preview styles for mobile
      CMS.registerPreviewStyle('/admin/preview.css');

      // Custom mobile-optimized widgets
      CMS.registerWidget('mobile-text', {
        control: function(props) {
          const input = document.createElement('input');
          input.type = 'text';
          input.className = 'mobile-optimized-input';
          input.style.fontSize = '16px'; // Prevent iOS zoom
          input.style.padding = '12px 16px';
          input.style.borderRadius = '12px';
          input.style.border = '2px solid #e5e7eb';
          input.style.width = '100%';
          input.value = props.value || '';
          
          input.addEventListener('input', (e) => {
            props.onChange(e.target.value);
          });
          
          return input;
        },
        preview: function(props) {
          return props.value || '';
        }
      });

      // Enhanced error handling for mobile
      window.addEventListener('error', (e) => {
        console.error('CMS Error:', e);
        showStatus('Error occurred', 'error');
      });

      window.addEventListener('unhandledrejection', (e) => {
        console.error('Unhandled promise rejection:', e);
        showStatus('Connection issue', 'error');
      });
    </script>
  </body>
</html>