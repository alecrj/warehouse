<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warehouse CMS</title>
  
  <!-- Mobile Optimization -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2563eb">
  
  <!-- Icon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  
  <!-- Netlify Identity -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <style>
    /* Clean, Mobile-First Styles */
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: #f8fafc;
    }
    
    /* Loading Screen */
    .cms-loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }
    
    .cms-loading.hidden {
      opacity: 0;
      pointer-events: none;
    }
    
    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 24px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .loading-subtitle {
      font-size: 14px;
      opacity: 0.8;
      text-align: center;
      max-width: 280px;
    }
    
    /* Login Screen */
    .login-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .login-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 32px;
      max-width: 400px;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .login-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .login-subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 32px;
    }
    
    .login-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
    }
    
    .login-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }
    
    /* Mobile-Responsive CMS Overrides */
    .nc-app-container {
      min-height: 100vh;
    }
    
    /* Mobile Navigation Improvements */
    @media (max-width: 768px) {
      .nc-app-container .css-1x5jdmq,
      .nc-app-container .css-1isemmb {
        padding: 12px !important;
      }
      
      .nc-app-container .css-1x5jdmq h1,
      .nc-app-container .css-1isemmb h1 {
        font-size: 20px !important;
      }
      
      /* Better mobile form spacing */
      .nc-app-container .css-1rr4qq7 {
        padding: 16px !important;
      }
      
      /* Improved mobile buttons */
      .nc-app-container button {
        min-height: 44px !important;
        font-size: 16px !important;
      }
      
      /* Better mobile sidebar */
      .nc-app-container .css-1dbjc4n {
        min-width: 250px !important;
      }
    }
    
    /* Success Toast */
    .success-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 500;
      z-index: 10000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    
    .success-toast.show {
      transform: translateX(0);
    }
    
    /* Hide elements during loading */
    .cms-hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="cms-loading" id="cmsLoading">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading CMS</div>
    <div class="loading-subtitle">Initializing your warehouse management system...</div>
  </div>
  
  <!-- Login Screen -->
  <div class="login-screen cms-hidden" id="loginScreen">
    <div class="login-card">
      <div class="login-title">üè¢ Warehouse CMS</div>
      <div class="login-subtitle">Sign in to manage your property listings</div>
      <button class="login-btn" onclick="netlifyIdentity.open()">
        Sign In
      </button>
    </div>
  </div>
  
  <!-- Success Toast -->
  <div class="success-toast" id="successToast">
    ‚úÖ CMS Ready! You can now manage your warehouses.
  </div>
  
  <!-- Netlify CMS Container -->
  <div id="nc-root" class="cms-hidden"></div>
  
  <!-- Scripts -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  
  <script>
    // Simple, Clean CMS Initialization
    let isInitialized = false;
    
    function showToast() {
      const toast = document.getElementById('successToast');
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    function initializeCMS() {
      if (isInitialized) return;
      isInitialized = true;
      
      console.log('üöÄ Initializing Warehouse CMS...');
      
      // Hide loading screen
      setTimeout(() => {
        document.getElementById('cmsLoading').classList.add('hidden');
        document.getElementById('nc-root').classList.remove('cms-hidden');
        showToast();
        console.log('‚úÖ CMS Ready!');
      }, 1000);
    }
    
    function showLogin() {
      document.getElementById('cmsLoading').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('cms-hidden');
    }
    
    // Netlify Identity Event Handlers
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on('init', user => {
        console.log('üîê Identity initialized', user ? 'with user' : 'without user');
        
        if (!user) {
          showLogin();
        } else {
          initializeCMS();
        }
      });
      
      window.netlifyIdentity.on('login', () => {
        console.log('‚úÖ User logged in');
        document.getElementById('loginScreen').classList.add('cms-hidden');
        initializeCMS();
      });
      
      window.netlifyIdentity.on('logout', () => {
        console.log('üëã User logged out');
        document.location.href = '/admin/';
      });
      
      window.netlifyIdentity.on('error', err => {
        console.error('‚ùå Identity error:', err);
        showLogin();
      });
    } else {
      console.error('‚ùå Netlify Identity not loaded');
      showLogin();
    }
    
    // Ensure CMS loads even if identity is slow
    setTimeout(() => {
      if (!isInitialized && window.netlifyIdentity && window.netlifyIdentity.currentUser()) {
        console.log('üîÑ Force initializing CMS...');
        initializeCMS();
      }
    }, 3000);
    
    // Clean error handling
    window.addEventListener('error', (e) => {
      console.error('üêõ CMS Error:', e.error);
    });
    
    // Mobile-specific optimizations
    if ('serviceWorker' in navigator) {
      // Simple service worker for offline support
      navigator.serviceWorker.register('/sw.js').catch(() => {
        // Silent fail for service worker
      });
    }
  </script>
</body>
</html>