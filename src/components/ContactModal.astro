---
// Modal component for the standardized contact form - Improved with glassmorphism and responsive design
interface Props {
  warehouses?: Array<{title: string, slug: string}>;
}

const { warehouses = [] } = Astro.props;

// Get all warehouses for the dropdown if not provided
let allWarehouses = warehouses;
if (allWarehouses.length === 0) {
  try {
    const { getCollection } = await import('astro:content');
    const warehouseCollection = await getCollection('warehouses');
    allWarehouses = warehouseCollection
      .filter(w => w.data.availability === 'available')
      .map(w => ({ title: w.data.title, slug: w.data.slug }));
  } catch (error) {
    console.log('Could not load warehouses for dropdown');
  }
}

// South Florida counties
const counties = [
  'Miami-Dade County',
  'Broward County', 
  'Palm Beach County'
];

// Price range options
const priceRanges = [
  '$3-5 per SF',
  '$5-7 per SF',
  '$7-10 per SF',
  '$10-15 per SF',
  '$15+ per SF',
  'Negotiable'
];

// Square footage options
const sqftRanges = [
  '500-2,000 SF',
  '2,000-5,000 SF',
  '5,000-10,000 SF',
  '10,000-25,000 SF',
  '25,000-50,000 SF',
  '50,000-100,000 SF',
  '100,000+ SF'
];
---

<!-- Modal Overlay -->
<div 
  id="contact-modal" 
  class="fixed inset-0 z-50 hidden"
  aria-labelledby="modal-title" 
  role="dialog" 
  aria-modal="true"
>
  <!-- Background overlay with glassmorphism -->
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity"></div>
  
  <!-- Modal panel -->
  <div class="fixed inset-0 overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-0 sm:p-4">
      <div class="relative transform overflow-hidden rounded-none sm:rounded-3xl bg-white/10 backdrop-blur-2xl border-0 sm:border border-white/20 shadow-2xl transition-all w-full h-full sm:h-auto sm:max-w-7xl sm:max-h-[95vh] overflow-y-auto">
        
        <!-- Close button -->
        <button 
          type="button" 
          class="absolute top-4 right-4 z-10 text-white/70 hover:text-white focus:outline-none bg-white/10 hover:bg-white/20 rounded-full p-2 transition-all duration-300"
          onclick="closeContactModal()"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>

        <!-- Modal content -->
        <div class="p-6 sm:p-8 h-full flex flex-col">
          <!-- Header -->
          <div class="text-center mb-6 sm:mb-6 flex-shrink-0">
            <h2 id="modal-title" class="text-2xl sm:text-2xl lg:text-3xl font-bold text-white mb-3 sm:mb-2">
              Get Matched With Warehouses
            </h2>
            <p class="text-white/80 text-base sm:text-sm lg:text-base">
              Tell us what you need and we'll send qualified options within 24 hours.
            </p>
          </div>

          <!-- Contact Info Display -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8 sm:mb-6 flex-shrink-0">
            <!-- Call Card -->
            <a 
              href="tel:954-937-9667"
              class="group flex items-center gap-4 p-6 sm:p-6 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 hover:bg-white/15 hover:scale-105 transition-all duration-300 cursor-pointer"
            >
              <div class="w-16 h-16 sm:w-14 sm:h-14 bg-green-500/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:bg-green-500/30 transition-all duration-300">
                <svg class="w-8 h-8 sm:w-7 sm:h-7 text-green-400 group-hover:text-green-300 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
              </div>
              <div>
                <div class="font-bold text-white text-base sm:text-base mb-1 group-hover:text-green-200 transition-colors duration-300">Call Now</div>
                <div class="text-green-400 font-semibold text-xl sm:text-lg group-hover:text-green-300 transition-colors duration-300">
                  (954) 937-9667
                </div>
              </div>
            </a>

            <!-- Email Card -->
            <a 
              href="mailto:info@warehouselocating.com"
              class="group flex items-center gap-4 p-6 sm:p-6 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 hover:bg-white/15 hover:scale-105 transition-all duration-300 cursor-pointer"
            >
              <div class="w-16 h-16 sm:w-14 sm:h-14 bg-blue-500/20 rounded-xl flex items-center justify-center flex-shrink-0 group-hover:bg-blue-500/30 transition-all duration-300">
                <svg class="w-8 h-8 sm:w-7 sm:h-7 text-blue-400 group-hover:text-blue-300 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
              </div>
              <div>
                <div class="font-bold text-white text-base sm:text-base mb-1 group-hover:text-blue-200 transition-colors duration-300">Email Us</div>
                <div class="text-blue-400 font-semibold text-base sm:text-sm group-hover:text-blue-300 transition-colors duration-300">
                  info@warehouselocating.com
                </div>
              </div>
            </a>
          </div>
          
          <!-- Form -->
          <form 
            name="warehouse-inquiry-modal" 
            method="POST" 
            data-netlify="true" 
            netlify-honeypot="bot-field"
            action="/success"
            class="flex-1 flex flex-col space-y-5 sm:space-y-4"
            onsubmit="closeContactModal()"
          >
            <!-- Hidden fields -->
            <input type="hidden" name="form-name" value="warehouse-inquiry-modal" />
            <input type="hidden" name="source" id="modal-source" value="modal" />
            <div class="hidden">
              <input name="bot-field" />
            </div>

            <!-- Form Grid - More compact layout -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 sm:gap-6 flex-1">
              <!-- Left Column -->
              <div class="space-y-4 sm:space-y-3">
                <!-- Name & Email Row -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-3">
                  <div>
                    <label for="modal-name" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Name *
                    </label>
                    <input 
                      type="text" 
                      id="modal-name" 
                      name="name" 
                      required 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/60 focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                      placeholder="Your Name"
                    />
                  </div>
                  <div>
                    <label for="modal-email" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Email *
                    </label>
                    <input 
                      type="email" 
                      id="modal-email" 
                      name="email" 
                      required 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/60 focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                      placeholder="your@email.com"
                    />
                  </div>
                </div>

                <!-- Phone & Company Row -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-3">
                  <div>
                    <label for="modal-phone" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Phone
                    </label>
                    <input 
                      type="tel" 
                      id="modal-phone" 
                      name="phone" 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/60 focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                      placeholder="(555) 123-4567"
                    />
                  </div>
                  <div>
                    <label for="modal-company" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Company
                    </label>
                    <input 
                      type="text" 
                      id="modal-company" 
                      name="company" 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/60 focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                      placeholder="Company Name"
                    />
                  </div>
                </div>

                <!-- Property Interest & County Row -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-3">
                  <div>
                    <label for="modal-property-interest" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Property Interest *
                    </label>
                    <select 
                      id="modal-property-interest" 
                      name="property-interest" 
                      required
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                    >
                      <option value="" class="bg-gray-800">Select property...</option>
                      <option value="any" class="bg-gray-800">Any Available Property</option>
                      <optgroup label="Specific Properties" class="bg-gray-800">
                        {allWarehouses.map(warehouse => (
                          <option value={warehouse.slug} class="bg-gray-800">
                            {warehouse.title}
                          </option>
                        ))}
                      </optgroup>
                    </select>
                  </div>

                  <div>
                    <label for="modal-county" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Preferred County
                    </label>
                    <select 
                      id="modal-county" 
                      name="county" 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                    >
                      <option value="" class="bg-gray-800">Select county...</option>
                      <option value="any" class="bg-gray-800">Any County</option>
                      {counties.map(county => (
                        <option value={county} class="bg-gray-800">{county}</option>
                      ))}
                    </select>
                  </div>
                </div>
              </div>

              <!-- Right Column -->
              <div class="space-y-4 sm:space-y-3">
                <!-- Size & Price Range Row -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-3">
                  <div>
                    <label for="modal-size-needed" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Size Needed (SF)
                    </label>
                    <select 
                      id="modal-size-needed" 
                      name="size-needed" 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                    >
                      <option value="" class="bg-gray-800">Select size range...</option>
                      {sqftRanges.map(range => (
                        <option value={range} class="bg-gray-800">{range}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label for="modal-price-range" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                      Price Range (per SF/year)
                    </label>
                    <select 
                      id="modal-price-range" 
                      name="price-range" 
                      class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                    >
                      <option value="" class="bg-gray-800">Select price range...</option>
                      {priceRanges.map(range => (
                        <option value={range} class="bg-gray-800">{range}</option>
                      ))}
                    </select>
                  </div>
                </div>

                <!-- Timing -->
                <div>
                  <label for="modal-timing" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                    Timing
                  </label>
                  <select 
                    id="modal-timing" 
                    name="timing" 
                    class="w-full px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 text-base sm:text-sm"
                  >
                    <option value="" class="bg-gray-800">Select timeline...</option>
                    <option value="immediate" class="bg-gray-800">Immediate (0-30 days)</option>
                    <option value="1-3-months" class="bg-gray-800">1-3 months</option>
                    <option value="3-6-months" class="bg-gray-800">3-6 months</option>
                    <option value="6-12-months" class="bg-gray-800">6-12 months</option>
                    <option value="12-months-plus" class="bg-gray-800">12+ months</option>
                    <option value="just-exploring" class="bg-gray-800">Just exploring options</option>
                  </select>
                </div>

                <!-- Requirements & Message -->
                <div class="flex-1">
                  <label for="modal-requirements" class="block text-sm sm:text-xs font-semibold text-white/90 mb-2 sm:mb-1">
                    Requirements & Message
                  </label>
                  <textarea 
                    id="modal-requirements" 
                    name="requirements" 
                    rows="4"
                    class="w-full h-full min-h-[100px] sm:min-h-[80px] px-4 py-3 sm:px-3 sm:py-2 rounded-lg border border-white/20 bg-white/10 backdrop-blur-sm text-white placeholder-white/60 focus:border-primary-400 focus:ring-1 focus:ring-primary-400/20 transition-all duration-300 resize-none text-base sm:text-sm"
                    placeholder="Tell us about your specific requirements: loading docks, clear height, special features, budget, location preferences, etc."
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="flex justify-center pt-6 sm:pt-4 flex-shrink-0">
              <button 
                type="submit" 
                class="w-full max-w-md bg-gradient-to-r from-primary-600 to-primary-700 text-white px-8 py-4 rounded-xl text-lg sm:text-lg font-bold hover:from-primary-700 hover:to-primary-800 hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 transform focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-transparent"
              >
                Submit
              </button>
            </div>

            <p class="text-sm sm:text-xs text-white/60 text-center flex-shrink-0">
              Free service • Landlords pay our fees • No obligation
            </p>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  function openContactModal(source = 'unknown') {
    const modal = document.getElementById('contact-modal');
    const sourceInput = document.getElementById('modal-source');
    
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Set the source for analytics
      if (sourceInput) {
        sourceInput.value = source;
      }
      
      // Focus on first input
      setTimeout(() => {
        const firstInput = modal.querySelector('#modal-name');
        if (firstInput) firstInput.focus();
      }, 100);
    }
  }

  function closeContactModal() {
    const modal = document.getElementById('contact-modal');
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  }

  // Close modal when clicking outside
  document.addEventListener('click', function(event) {
    const modal = document.getElementById('contact-modal');
    if (modal && event.target === modal) {
      closeContactModal();
    }
  });

  // Close modal with Escape key
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      closeContactModal();
    }
  });

  // Global function to open modal (can be called from any button)
  window.openContactModal = openContactModal;
  window.closeContactModal = closeContactModal;
</script>